"use strict";require("./preloadImgs.js");var _rain=require("./rain.js"),_sunshine=require("./sunshine.js"),_cloud=require("./cloud.js"),_cloud2=_interopRequireDefault(_cloud);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}$("html").attr("overflow-y","hidden");var canvas1=document.getElementById("canvas1"),canvas2=document.getElementById("canvas2"),canvasImgsArray=["../imgs/cloud1.png","../imgs/cloud2.png","../imgs/cloud3.png","../imgs/rain.png","../imgs/sun.png","../imgs/sunny_doll1.png","../imgs/sunny_doll2.png"],pCanvas=document.getElementById("picture"),context1=canvas1.getContext("2d"),context2=canvas2.getContext("2d"),pContext=pCanvas.getContext("2d"),main=$("main:first"),head=$("nav.head:first"),w1=canvas1.width=main.width(),h1=canvas1.height=window.innerHeight-head.height(),w2=canvas2.width=main.width(),h2=canvas2.height=window.innerHeight-head.height(),pw=void 0,ph=void 0;window.onresize=function(){w1=canvas1.width=main.width(),h1=canvas1.height=window.innerHeight-head.height(),w2=canvas2.width=main.width(),h2=canvas2.height=window.innerHeight-head.height(),pw=pCanvas.width=Math.floor(2*w1/10),ph=pCanvas.height=Math.floor(4*h1/10)};var ip=returnCitySN.cip;function rain(){$("#text").show(),$("#picture").css({top:"60%",left:"80%"}),pw=pCanvas.width=Math.floor(2*w1/10),ph=pCanvas.height=Math.floor(4*h1/10),pContext.fillStyle="rgba(255, 255, 255, 0)",pContext.fillRect(0,0,pw,ph);var e=[],n=new Image;n.src="../imgs/rain.png";for(var t=0;t<1e3;t++)setTimeout(function(){var n=new _rain.Drop(context1,w1,h1);e.push(n)},1e3/60*t);new _rain.Umbrella(pContext,pw,ph).draw(n),setInterval(function(){context1.clearRect(0,0,w1,h1);for(var n=0;n<e.length;n++)e[n].draw()},1e3/60)}function sunshine(){$("#text").hide(),$("#picture").css({top:"10px",left:"10%"}),pw=pCanvas.width=Math.floor(w1/10),ph=pCanvas.height=Math.floor(w1/10),pContext.fillStyle="rgba(255, 255, 255, 0)",pContext.fillRect(0,0,pw,ph);var e=new _sunshine.Sun(pContext,pw,ph),n=new Image;n.src="imgs/sun.png",e.draw(n),setInterval(function(){e.rotate(),e.draw(n)},500);var t=new _sunshine.SunnyDoll(context1,w1,h1),a=new Image,o=new Image;o.src="imgs/sunny_doll2.png",a.src="imgs/sunny_doll1.png",t.draw(a);var i=1;setInterval(function(){t.move(),i%2==1?t.draw(o):t.draw(a),200===++i&&(i=0)},1e3/6)}function cloudy(){var e=new _cloud2.default(context2,w2,h2,.1*w2,w2/35),n=new _cloud2.default(context2,w2,h2),t=new _cloud2.default(context2,w2,h2),a=new Image,o=new Image,i=new Image;e.draw(a),n.draw(o),t.draw(i),a.src="imgs/cloud1.png",o.src="imgs/cloud2.png",i.src="imgs/cloud3.png",setInterval(function(){context2.clearRect(0,0,w2,h2),n.move(),t.move(),e.draw(a),n.draw(o),t.draw(i)},1e3/60)}console.log("ip : "+ip),$.ajax({url:"/weather/?ip="+ip,type:"GET",dataType:"json",success:function(e){if(e.err)console.log(e.err);else{console.log("weather data is:"),console.log(e);var n=e.data,t=(n.location,n.weather);n.temperature;$.preload(canvasImgsArray,{each:function(){},all:function(){-1!==t.indexOf("晴")?(console.log("晴"),sunshine()):-1!==t.indexOf("云")?(console.log("多云"),sunshine(),cloudy()):-1!==t.indexOf("阴")?(console.log("阴"),cloudy()):-1!==t.indexOf("雨")?(console.log("雨"),rain()):console.log("未知")}})}},err:function(e){console.log("Get weather is error,because "+e)}});